# Balance Day IB Edge Fade Study — Research Plan

## Context

We have confirmed strategies for 80P, 20P, and VA Edge Fade. Trend day strategies are retired (34.8% WR bull, 16.7% bear — 80P/20P already cover those setups). Now we're tackling the missing piece: **balance days** (B-day, P-day, Neutral, Wide IB).

**What was tried and failed:**
- NT8 BalanceSignal (6-factor scoring + VA edge fade): **12.5% WR on B-days** — was fading prior-day VA edges instead of IB edges. 75% WR on P-days (wrong day type).
- B-Day IBL Fade (b_day.py): 71.4% WR (5/7) — promising but N=7 is too small to trust.
- IBH Sweep Short (b_day only): 100% WR (4/4) — but only 5 trades in 62 sessions.
- Neutral day: No mechanical edge found.

**Core insight from prior research:** Delta confirmation at structural levels is the strongest filter discovered (83% WR for bracket retrace, vs 28% without). We need to test this principle on IB edge fades.

**What the user wants:** Fade IB edges on balance days with acceptance confirmation, using VWAP as the bull/bear demarcation, POC location + HVN/LVN for skew, and BPR for launch zones. **Targets are dynamic based on developing day type:**
- **Neutral (POC at center):** Target IB midpoint — clean mean reversion
- **B-skew (POC migrating down):** After reclaiming IBL, target the HVN/LVN seam (may coincide with VWAP or IB mid)
- **P-skew (POC migrating up):** Reject high, sweep above VWAP fails → short back to IBL
- **VWAP is the rotation demarcation** — price sweeps above VWAP and fails = short; sweeps below and reclaims = long
- The key is **classifying the developing day type early** (by 10:30-11:00) to know where to fade and where to target

**Trend day strategies are confirmed retired** — 80P/20P framework already covers those setups.

---

## Study Script: `study_balance_day_edge_fade.py`

### Data Loading (reuse existing infra)
- `load_csv('NQ')` → `filter_rth()` → `compute_all_features()`
- Existing columns available: `ib_high`, `ib_low`, `ib_range`, `day_type`, `day_direction`, `delta`, `cumulative_delta`, `delta_percentile`, `vwap`, `fvg_bull`, `fvg_bear`, `in_bpr`, `ifvg_bull_entry`, `ifvg_bear_entry`, `volume`, `vol_ask`, `vol_bid`, `atr14`
- Compute per-session IB POC using `calculate_value_area()` on just the IB bars (first 60 1-min bars)
- Compute per-session day type using existing classification

### Part 1: Foundation — Day Type Frequency & Early Identification (~80 lines)

**Goal:** Establish base rates. How many balance days exist? Can we identify them early?

1. **Day type distribution** across 259 sessions:
   - Count B-day, P-day (bull+bear), Neutral, Trend (bull+bear)
   - IB width stats per day type (mean, median, 25th/75th)
   - Per-month frequency

2. **IB width distribution** — histogram buckets:
   - Narrow (<100 pts), Normal (100-200), Wide (200-300), Very Wide (300-400), Extreme (>400)
   - Cross-reference with EOD day type

3. **Early identification accuracy** — can we call it at 10:30 (IB close)?
   - Compute "IB-close day type prediction" using extension at bar 60
   - Compare to EOD actual day type → accuracy matrix
   - Same at C-period close (bar 90, 11:00)

4. **C-period rule validation** across full 259 sessions:
   - C closes above IBH → continuation rate
   - C closes below IBL → continuation rate
   - C closes inside IB → reversal rate
   - Compare to claimed 70-75% edge

### Part 2: IB Edge Touch & Rejection Analysis (~120 lines)

**Goal:** On balance days, how do IB edge touches behave?

5. **IB edge touch frequency** on balance days (B-day + Neutral + wide-IB P-day):
   - How often does price touch IBH after IB? Touch IBL?
   - Touches defined as: bar low ≤ IBL + 5pts (IBL touch) or bar high ≥ IBH - 5pts (IBH touch)
   - Time of first touch, second touch, etc.

6. **Rejection success rate** — after touching IBL/IBH, does price return to IB mid?
   - Define "successful fade": price closes at IB midpoint or beyond within 60 bars of touch
   - Define "failed fade": price extends > 0.5x IB range beyond the edge, or doesn't reach mid
   - Compute success rates by: direction (IBL long vs IBH short), day type, touch number (1st/2nd/3rd)

7. **What differentiates successful vs failed rejections?**
   - Delta at the touch bar (positive = buyers, negative = sellers)
   - Penetration depth (how far past the IB edge did price go?)
   - Volume spike at touch
   - Time of day (IB exit vs lunch vs PM)
   - Number of bars spent outside IB before rejection
   - Cumulative delta direction leading into the touch

### Part 3: Volume Profile Shape — POC/VWAP as Skew Filter (~80 lines)

**Goal:** Does the shape of the IB volume profile predict which edge will reject?

8. **IB POC location classification:**
   - Compute POC from first 60 bars using `calculate_value_area()` on IB-only data
   - Classify: Upper third (P-shape), Lower third (b-shape), Center (D-shape/Neutral)
   - Cross-reference with EOD day type — does IB POC predict day type?

9. **POC alignment with fade direction:**
   - b-shape (POC low) + IBL fade LONG = "aligned" (fading toward POC)
   - P-shape (POC high) + IBH fade SHORT = "aligned"
   - Does alignment improve fade WR?

10. **VWAP as demarcation:**
    - At time of IB edge touch, where is VWAP relative to IB mid?
    - VWAP above IB mid = bullish bias → IBL fades should work better
    - VWAP below IB mid = bearish bias → IBH fades should work better
    - Test this hypothesis

### Part 4: Acceptance Model Comparison (~100 lines)

**Goal:** Which confirmation method best confirms the IB edge fade?

11. **Test 4 acceptance models** for IB edge fades:
    - **2x1min**: 2 consecutive 1-min closes back inside IB (fastest, from NT8 design)
    - **2x5min**: 2 consecutive 5-min period closes inside IB (user's preferred)
    - **1x30min**: 1 thirty-minute period close inside IB (Dalton standard)
    - **Delta-only**: Delta aligns with bounce direction at touch (no time-based acceptance)

    For each: compute WR, avg P&L, number of signals, false positive rate

12. **Combined: acceptance + delta** — does adding delta to any acceptance model improve WR?

### Part 5: Entry Model Backtests (~150 lines)

**Goal:** Find the highest-edge entry model for IB edge fades.

13. **Entry models to test** (all on balance-day IB edge touches):

    | ID | Entry | Stop | Target | Description |
    |----|-------|------|--------|-------------|
    | A | 2x5min accept | IBL - 10% IB | IB mid | Baseline fade |
    | B | 2x5min + delta > 0 | IBL - 10% IB | IB mid | + delta confirmation |
    | C | 2x5min + delta + BPR/FVG | IBL - 10% IB | IB mid | + ICT structure |
    | D | 2x5min + POC aligned | IBL - 10% IB | IB mid | + shape filter |
    | E | 2x5min + VWAP confirm | IBL - 10% IB | VWAP | VWAP as target |
    | F | All filters combined | IBL - 10% IB | IB mid | Maximum quality |
    | G | Delta-only (no acceptance) | IBL - 10% IB | IB mid | Speed vs quality |
    | H | 30min accept | IBL - 10% IB | IB mid | Dalton standard |

    Mirror all for IBH SHORT entries.

14. **Dynamic target based on developing profile shape:**
    - **D-shape (neutral POC at center):** Target = IB midpoint
    - **b-shape (POC low, bearish skew) + IBL LONG:** Target = VWAP or HVN/LVN seam above (whichever is closer)
    - **P-shape (POC high, bullish skew) + IBH SHORT:** Target = VWAP or HVN/LVN seam below
    - **VWAP sweep fail:** If price swept above/below VWAP and rejected → target = opposite IB edge
    - Test each target mode independently AND the dynamic selection

15. **Static target comparison** (for reference): IB midpoint vs VWAP vs developing POC vs 2R

16. **Direction filter:** LONG-only vs SHORT-only vs BOTH (NQ long bias check on balance days too)

### Part 5B: VWAP Sweep Fail Pattern (~60 lines)

**Goal:** Test the specific pattern the user described — price sweeps above/below VWAP and fails back.

- On b-day: price drops, reclaims IBL, rallies to VWAP, sweeps above VWAP, fails → SHORT back to IBL
- On P-day: price rallies, rejects IBH, pulls back to VWAP, sweeps below VWAP, fails → LONG back to IBH
- Detect: bar high > VWAP + 3pts, then next 2x5min closes below VWAP → SHORT (and mirror)
- This is the "VWAP as rotation demarcation" concept — treat VWAP as the seam
- Compare WR/P&L to the IB edge fade entries

### Part 6: Wide IB Balance Days (~60 lines)

**Goal:** Do wide IB days (200-400 pts) that stay inside have different characteristics?

16. **Wide IB balance identification:**
    - Sessions where IB range > 200 pts AND price never closes > 0.3x IB range beyond IBH/IBL
    - How many exist? Per month?

17. **Wide IB edge fade behavior:**
    - Same rejection analysis as Part 2 but filtered to wide IB only
    - Are wide IB fades more reliable (bigger range = more room for mean reversion)?
    - Optimal stop/target sizing for wide IB

### Part 7: Combined Optimal & Strategy Card (~50 lines)

18. **Stack best filters** from Parts 2-6:
    - Find the highest WR combination with ≥ 2 trades/month
    - Monthly P&L at 5 MNQ
    - Compare to 80P ($1,922/mo), 20P ($496/mo), bracket retrace ($415/mo)

19. **Final strategy card** with exact entry/exit rules

---

## Files to Create/Modify

| File | Action | Description |
|------|--------|-------------|
| `study_balance_day_edge_fade.py` | **CREATE** | Main study script (~650 lines) |
| `research/2026.02.26-balance-day-edge-fade-study.md` | **CREATE** | Research report with findings |

## Existing Files to Reuse (read-only)

| File | What We Use |
|------|-------------|
| `data/loader.py` | `load_csv('NQ')` |
| `data/session.py` | `filter_rth()` |
| `data/features.py` | `compute_all_features()` — gives us IB, delta, VWAP, FVG, BPR, day_type |
| `indicators/value_area.py` | `calculate_value_area()` — for IB POC computation |
| `indicators/ib_width.py` | IB width classification reference |
| `config/instruments.py` | `get_instrument('MNQ')` |

## Verification

1. Run `python study_balance_day_edge_fade.py` — should complete in <5 minutes
2. Review all printed tables for statistical significance (N ≥ 20 for reliable findings)
3. Cross-check delta-at-rejection finding against the 83% WR from bracket breakout study
4. Verify no look-ahead bias in acceptance model (acceptance uses only past/current bars)
5. Commit study script + research report, push to branch
